{
  "$schema": "http://json-schema.org/schema",
  "additionalProperties": false,
  "description": "VERIS Community Schema 1.4 development",
  "properties": {
    "steps": {
        "type": "array",
        "uniqueItems": false,
        "items": {
          "type": "object",
          "properties": {
            "action": {
              "minProperties": 1,
              "properties": {
                "environmental": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "variety"
                  ],
                  "type": "object"
                },
                "error": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "variety",
                    "vector"
                  ],
                  "type": "object"
                },
                "hacking": {
                  "additionalProperties": false,
                  "properties": {
                    "cve": {
                      "type": "string"
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "vector",
                    "variety"
                  ],
                  "type": "object"
                },
                "malware": {
                  "additionalProperties": false,
                  "properties": {
                    "cve": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "vector",
                    "variety"
                  ],
                  "type": "object"
                },
                "misuse": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "vector",
                    "variety"
                  ],
                  "type": "object"
                },
                "physical": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "vector",
                    "variety"
                  ],
                  "type": "object"
                },
                "social": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "target": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "vector": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "vector",
                    "variety",
                    "target"
                  ],
                  "type": "object"
                },
                "unknown": {
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              },
              "type": "object"
            },
            "actor": {
              "additionalProperties": false,
              "minProperties": 1,
              "properties": {
                "external": {
                  "additionalProperties": false,
                  "properties": {
                    "country": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "motive": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "name": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "region": {
                      "items": {
                        "type": "string",
                        "maxLength":6,
                        "minLength":6
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "country",
                    "variety",
                    "motive"
                  ],
                  "type": "object"
                },
                "internal": {
                  "additionalProperties": false,
                  "properties": {
                    "motive": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "job_change": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "motive",
                    "variety"
                  ],
                  "type": "object"
                },
                "partner": {
                  "additionalProperties": false,
                  "properties": {
                    "country": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "industry": {
                      "maxLength":6,
                      "minLength":2,
                      "pattern":"\\d{2}-?\\d{0,4}",
                      "type": "string"
                    },
                    "motive": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "region": {
                      "items": {
                        "type": "string",
                        "maxLength":6,
                        "minLength":6
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "country",
                    "motive"
                  ],
                  "type": "object"
                },
                "unknown": {
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              },
              "type": "object"
            },
            "asset": {
              "additionalProperties": false,
              "minProperties": 1,
              "properties": {
                "assets": {
                  "items": {
                    "additionalProperties": false,
                    "properties": {
                      "amount": {
                        "type": "integer"
                      },
                      "variety": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "variety"
                    ],
                    "type": "object"
                  },
                  "minItems": 1,
                  "type": "array",
                  "uniqueItems": true
                },
                "cloud": {
                  "type": "string"
                },
                "country": {
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1,
                  "type": "array",
                  "uniqueItems": true
                },
                "governance": {
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1,
                  "type": "array",
                  "uniqueItems": true
                },
                "notes": {
                  "minLength": 1,
                  "type": "string"
                }
              },
              "type": "object"
            },
            "attribute": {
              "additionalProperties": false,
              "minProperties": 1,
              "properties": {
                "availability": {
                  "properties": {
                    "duration": {
                      "additionalProperties": false,
                      "properties": {
                        "unit": {
                          "type": "string"
                        },
                        "value": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "unit"
                      ],
                      "type": "object"
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "variety"
                  ],
                  "type": "object"
                },
                "confidentiality": {
                  "additionalProperties": false,
                  "properties": {
                    "data": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "amount": {
                            "type": "integer"
                          },
                          "variety": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "variety"
                        ],
                        "type": "object"
                      },
                      "minItems": 1,
                      "type": "array"
                    },
                    "data_disclosure": {
                      "type": "string"
                    },
                    "data_total": {
                      "type": "integer"
                    },
                    "data_victim": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "state": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "data_disclosure"
                  ],
                  "type": "object"
                },
                "integrity": {
                  "additionalProperties": false,
                  "properties": {
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "variety": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array",
                      "uniqueItems": true
                    }
                  },
                  "required": [
                    "variety"
                  ],
                  "type": "object"
                }
              },
              "type": "object"
            },
            "confidence": {
              "type": "string"
            },
            "control_failure": {
              "type": "string"
            },
            "discovery_method": {
              "type": "string"
            },
            "timeline": {
              "additionalProperties": false,
              "properties": {
                "compromise": {
                  "additionalProperties": false,
                  "properties": {
                    "unit": {
                      "type": "string"
                    },
                    "value": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "unit"
                  ],
                  "type": "object"
                },
                "containment": {
                  "additionalProperties": false,
                  "properties": {
                    "unit": {
                      "type": "string"
                    },
                    "value": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "unit"
                  ],
                  "type": "object"
                },
                "discovery": {
                  "additionalProperties": false,
                  "properties": {
                    "unit": {
                      "type": "string"
                    },
                    "value": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "unit"
                  ],
                  "type": "object"
                },
                "exfiltration": {
                  "additionalProperties": false,
                  "properties": {
                    "unit": {
                      "type": "string"
                    },
                    "value": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "unit"
                  ],
                  "type": "object"
                }
              },
              "type": "object"
            },
            "victim": {
              "additionalProperties": false,
              "properties": {
                "country": {
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1,
                  "type": "array",
                  "uniqueItems": true
                },
                "employee_count": {
                  "type": "string"
                },
                "industry": {
                  "maxLength":6,
                  "minLength":2,
                  "pattern":"\\d{2}-?\\d{0,4}",
                  "type": "string"
                },
                "locations_affected": {
                  "type": "integer"
                },
                "notes": {
                  "minLength": 1,
                  "type": "string"
                },
                "region": {
                  "items": {
                    "type": "string",
                    "maxLength":6,
                    "minLength":6
                  },
                  "minItems": 1,
                  "type": "array",
                  "uniqueItems": true
                },
                "revenue": {
                  "additionalProperties": false,
                  "minProperties": 1,
                  "properties": {
                    "amount": {
                      "type": "integer"
                    },
                    "iso_currency_code": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                },
                "secondary": {
                  "additionalProperties": false,
                  "minProperties": 1,
                  "properties": {
                    "amount": {
                      "type": "integer"
                    },
                    "notes": {
                      "minLength": 1,
                      "type": "string"
                    },
                    "victim_id": {
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1,
                      "type": "array"
                    }
                  },
                  "type": "object"
                },
                "state": {
                  "type": "string"
                },
                "victim_id": {
                  "type": "string"
                }
              },
              "required": [
                "country",
                "employee_count",
                "industry"
              ],
              "type": "object"
            }
          },
          "required": [
            //"actor",
            //"action",
            "discovery_method"
            //"asset",
            //"timeline"
          ]
          // by having no 'required' 4A's, we allow steps to be missing any given value
          // unfortunately, this also means it's possible schema-wise to enter an incident
          // without any of the 4A's.  As such, required fields must be tested for
          // separately from schema validation.
        }
    },
    "campaign_id": {
      "type": "string"
    },
    "corrective_action": {
      "type": "string"
    },
    "cost_corrective_action": {
      "type": "string"
    },
    "discovery_notes": {
      "minLength": 1,
      "type": "string"
    },
    "impact": {
      "additionalProperties": false,
      "properties": {
        "iso_currency_code": {
          "type": "string"
        },
        "loss": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "amount": {
                "type": "number"
              },
              "max_amount": {
                "type": "number"
              },
              "min_amount": {
                "type": "number"
              },
              "rating": {
                "type": "string"
              },
              "variety": {
                "type": "string"
              }
            },
            "required": [
              "variety"
            ],
            "type": "object"
          },
          "minItems": 1,
          "type": "array"
        },
        "notes": {
          "minLength": 1,
          "type": "string"
        },
        "overall_amount": {
          "type": "number"
        },
        "overall_max_amount": {
          "type": "number"
        },
        "overall_min_amount": {
          "type": "number"
        },
        "overall_rating": {
          "type": "string"
        }
      },
      "required": [
        "overall_rating"
      ],
      "type": "object"
    },
    "incident_id": {
      "type": "string"
    },
    "ioc": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "comment": {
            "type": "string"
          },
          "indicator": {
            "type": "string"
          }
        },
        "required": [
          "indicator"
        ],
        "type": "object"
      },
      "minItems": 1,
      "type": "array"
    },
    "notes": {
      "minLength": 1,
      "type": "string"
    },
    "plus": {
      "type":"object",
      "properties":{},
      "additionalProperties": true
    },
    // Trying to decide how to represent subsets like patterns, secondary-motive, dridex, 
    //   malicious vs non-malicious
    // This is here as a placeholder. Subsets may be only a verisr thing and not a VERIS thing at all.
//    "subsets": {
//      "type":"array",
//      "uniqueItems": false,
//      "items": {
//        "type": "object",
//        "properties": {
//          "name": {
//            "type": "string",
//            "minLength": 1
//          },
//          "value": {
//            "type": "boolean"
//          }
//        }
//      }
//    },
    "reference": {
      "type": "string"
    },
    "schema_version": {
      "type": "string"
    },
    "security_incident": {
      "type": "string"
    },
    "source_id": {
      "type": "string"
    },
    "summary": {
      "type": "string"
    },
    "targeted": {
      "type": "string"
    },
    "timeline": {
      "additionalProperties": false,
      "properties": {
        "incident": {
          "additionalProperties": false,
          "properties": {
            "day": {
              "type": "integer",
              "maximum": 31,
              "minimum": 1
            },
            "month": {
              "type": "integer",
              "maximum": 12,
              "minimum": 1
            },
            "time": {
              "type": "string"
            },
            "year": {
              "type": "integer",
              "maximum": 2020,  // bumping this out to a more reasonable time.  still needs regular updating. -GDB 04/16/16
              "minimum": 1950
            }
          },
          "required": [
            "year"
          ],
          "type": "object"
        }
      },
      "required": [
        "incident"
      ],
      "type": "object"
    }
  },
  // Required 4A properties moved to steps where they may or may not exist in any given step and so
  //  cannot be required and must be checked manually rather than against the schema. - GDB 05/16/16
  "required": [
    //"actor",
    //"action",
    //"discovery_method",
    "schema_version",
    //"asset",
    "timeline",
    "incident_id",
    "security_incident"
  ],
  "type": "object"
}
